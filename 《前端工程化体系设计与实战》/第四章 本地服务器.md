# 第四章 本地开发服务器

本地开发服务器与构建系统相结合，可以有效的提高开发效率。<br />

<a name="h3J9F"></a>

## 本地开发服务器解决的问题

动态构建解决的主要问题是面向开发层面。通过监听->修改->触发->构建的流程避免源码每次修改都需要人为的执行一次构建，便于开发过程的及时调试。<br />
<br />Mock 服务解决的面向前后端协作层面的问题，已提前约定好的规范为前提，通过本地服务容器提供 Mock 数据接口辅助前端逻辑的编写。<br />

<a name="lW0NV"></a>

### 动态构建

必要性：前端在开发期间的及时调试。<br />
<br />动态构建是连接源码和加工机器的管道，这个管道有两个供能：监听和触发。当管道开启时，源码的任何修改都回被监听模块检测到，然后触发模块唤起构建这台加工机器对改动后的源码进行加工。<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/296173/1587022920693-c08be0d3-8421-4cc5-9f58-92907ca088df.png#align=left&display=inline&height=360&margin=%5Bobject%20Object%5D&name=image.png&originHeight=720&originWidth=1540&size=447475&status=done&style=none&width=770)
<a name="t4ZtG"></a>

### Mock 服务

部分前端逻辑开发必须以服务器端数据接口完成为前提，这极大的造成了开发周期拉长，以及沟通成本加大的问题。当我们有了 Mock 数据接口时，在服务器断开发的同时，我们前端也可以并行开发，待服务器端接口开发完成后将接口请求地址从 Mock 迁往服务器环境即可。Mock 服务能够发挥作用的必要前提是：前后端开发人员在进入开发之前协商好数据接口的规范。<br />
<br />如果项目不是完全的前后端分离，仍然需要服务器端渲染 HTML，并且本地开发服务器使用与服务器端同样的编程语言，那么 MOCK 服务还需要具备 SSR 功能：

1. 支持与服务器相同的 HTML 模板引擎
1. SSR 所需的 Mock 数据

<br />

<a name="1Qtus"></a>

## 动态构建

<br />动态构建，又称之为动态编译，起源于 Self，推广于 Java。但前端工程体系中的动态编译和 Java 中不同，应用 Java 的动态编译最普遍的是即时编译（JIT），将部分代码编译行为推迟到运行时执行，从而提高性能。而前端的则没那么复杂，最主要的目的时节省人力，方便前端开发和调试，原理是：监听+触发<br />
<br />webpack-dev-server 是官方提供的用于搭建本地开发环境的一个微型 Node.JS 服务框架，提供动态编译，HMR 等功能。<br />

<a name="umwdw"></a>

## Mock 服务

动态构建解决的前端单方面所遇到的问题。而 Mock 服务针对的是前后端协作层面的问题，通过模拟数据解耦了前端逻辑的编写对后端接口的依赖。<br />

<a name="odXgi"></a>

### Mock 的必要前提及发展历程

必要前提：前后都安协定接口的规范细节，包括请求方法，入参，返回值等。<br />

<a name="XXgiB"></a>

#### 发展历程

<a name="285v1"></a>

##### 1.假数据

缺点：

1. 会产生大量假数据对象以及注释，且上线前还需要对其进行删除
1. 无法模拟接口的请求流程以及异常状态

<a name="BVdwB"></a>

##### 2.客户端 Mock

工作原理：在客户端拦截 JavaScript 代码发出的 Ajax 请求并返回有 Mock.JS 创建的假数据。<br />
<br />优点：

1. 解决了代码中直接编写假数据无法模拟请求流程和异常处理的问题
1. 客户端 Mock 相当于创建了一个模拟接口，而不是争对某个接口的假数据。方便统一维护。

<a name="zsQuf"></a>

##### 3.Mock Server

以上两种都涉及业务代码的修改，而从工程化的角度来看，将 Mock 作为一种服务集成到前端工程体系中的工作流如下：

- 开发阶段使用 Mock Server 提供的于真实接口规范和逻辑一致的本地接口开发
- 开发完成后，在构建阶段将 Mock 的地址修改为已完成的真实服务器端的接口地址

![image.png](https://cdn.nlark.com/yuque/0/2020/png/296173/1587030391901-4b8b6e99-1860-4383-9329-843e0ad2ad45.png#align=left&display=inline&height=372&margin=%5Bobject%20Object%5D&name=image.png&originHeight=744&originWidth=1634&size=747420&status=done&style=none&width=817)
<a name="NJ8EM"></a>

### 异步数据接口

Mock Server 最普遍的就是模拟异步接口数据，比如

- AJAX
- JSONP

模拟方式通常有以下两种：

- local——本地模式：使用本地的 JSON 数据作为异步接口的请求响应
- Proxy——代理模式：将异步接口代理到线上的其他接口地址，作为转接者的角色

<a name="uvBC6"></a>

#### 1.local

原理：在开发阶段使用本地 API 代替真实 API 地址，使用本地 JSON 作为接口的返回数据。<br />
<br />搭建流程：

1. 通过路由创建一个可访问的本地域名 API 代替真实 API
1. 在路由响应函数内对请求进行校验，比如是否为 JSONP 请求，然后返回本地 JSON 数据

<a name="cL7kh"></a>

#### 2.Proxy

Proxy 主要有以下一些功能

- 规模庞大的业务往往需要多台不同域的服务提供不同的数据服务，比如用
  户相关的服务处于 auth.app.com 域名内，主站服务处于 www.app.com
  域名内。
- 假设迭代需求不涉及主站接口 [http://www.app.com/data](http://www.app.com/data) 的改动，开发阶段不必花费精力创建此接口的 Mock，可以直接使用生产环境
  的服务。
- 主站 www.app. com 的接口不支持跨域请求。项目上线后处于主站同域名内，
  所以生产环境不涉及跨域请求。
- 前端工程师所处的开发环境域名为 localhost，由于某些业务限制，不能
  通过修改 host 文件将本地 IP 映射为 www.app.com。

      <br />

  <br />
